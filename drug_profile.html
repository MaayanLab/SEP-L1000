<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Prediction of drug side effects</title>
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="//cdn.datatables.net/plug-ins/725b2a2115b/integration/bootstrap/3/dataTables.bootstrap.css">
  <link rel="stylesheet" href="css/jquery-ui.css" />
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->
    </head>
    <body data-spy="scroll" data-target=".col-md-2" style="position:relative;" data-offset="0">
      <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
      <script src="js/jquery-ui.min.js"></script>
      <script src="https://cdn.datatables.net/1.10.1/js/jquery.dataTables.js"></script>
      <script src="//cdn.datatables.net/plug-ins/725b2a2115b/integration/bootstrap/3/dataTables.bootstrap.js"></script>    
      <script src="js/dataTables.colReorder.js"></script>
      <script src="js/dataTables.tableTools.min.js"></script>
      <script src="js/bootstrap.min.js"></script>
      <script src="js/functions.js"></script>
      <script src="js/d3.min.js"></script>
      <div id="nav"></div>
      <script type="text/javascript">
      $("#nav").load("nav.html");
      </script>
      <div class="container">
        <div class="row">
          <div class="col-md-2">
            <div class="affix" role="navigation">
              <ul class="nav nav-pills nav-stacked" role="tablist">
                <li><a href="#drug_side_effects">Predicted side effects</a></li>
                <li><a href="#drug_info">Drug information</a></li>              
              </ul>
            </div>
          </div>
          <div class="col-md-10">
            <div class="panel panel-primary" id="drug_side_effects">
              <div class="panel-heading"></div>
              <div class="panel-body"><div class="row text-center"><img src="img/ajax-loader.gif"></div></div>
            </div>
            <div id="drug_info"></div>
          </div>
        </div>
      </div>

      <script type="text/javascript">
      var $_GET = getQueryParams(document.location.search);
      var pert_id = $_GET['pert_id'];
      $("#cpd_img").attr("src", "img/cpd-images/" +pert_id+".png")

      $(".panel-heading").html('Predicted side effects for ' + pert_id);

      $(document).ready(function(){
  $.getJSON('get_drug_se.php', {'pert_id' : pert_id}, function(json){ // load predicted SEs for the drug
    var table = $('<table class="table table-hover table-striped" id="table_se"><thead><tr><th>Name</th><th>UMLS Concept ID</th><th>probability</th><th>already labeled?</th></tr></thead></table>')
    var tbody = objs2TableRows(json, 'umls_id', 'se_profile.html?umls_id=');

    table.append(tbody);
    $(".panel-primary .panel-body").html(table);

  }).then(function(){
    $("#table_se").dataTable({
      dom: 'Rlfrtip',
      colReorder:{order: [1,0,2,3]},
      "order": [[2, 'desc']],
      "deferRender": true,
    });
  });

  $.getJSON('drug_profile.php', {'pert_id' : pert_id}, function(json){ // load meta data for the drug
    $.each(json, function(key, obj){
      var table = obj2Table(obj);
      var div = $('<div class="panel">');
      var panelHead = $('<div class="panel-heading">');
      panelHead.append('<span class="glyphicon glyphicon-info-sign"></span>');
      var panelBody = $('<div class="panel-body">');

      if (key === 'drugs_lincs') {
        div.addClass('panel-success');
        var lincsUrl = 'http://apps.lincscloud.org/sandbox/pert_info#' + obj['pert_iname'];
        panelHead.wrapInner('<a target="_blank" href="' + lincsUrl + '">Information from lincscloud</a>');
      };

      div.append(panelHead);
      row = $('<div class="row" id="lincs_row">')
      var imgURL = 'img/cpd-images/'+pert_id+'.png'
      var imgDiv = $('<div class="col-md-2">')
      var tableDiv = $('<div class="col-md-10">')
      imgDiv.append('<a href="'+imgURL+'"><img height="150" width="150" src="'+imgURL+'" title="Chemical structure for '+pert_id+'"></a>')
      tableDiv.append(table);
      row.append(imgDiv)
      row.append(tableDiv)
      panelBody.append(row)
      div.append(panelBody);
      div.appendTo("#drug_info");
    });
}).done(function(){ // linkouts in the form
  $('#LSM_id td').eq(1).wrapInner(function(){
    return '<a target="_blank" href="http://life.ccs.miami.edu/life/summary?mode=SmallMolecule&source=LINCS&input='+$(this).text()+'"></a>'
  });
  $('#pubchem_cid td').eq(1).wrapInner(function(){
    return '<a target="_blank" href="https://pubchem.ncbi.nlm.nih.gov/compound/'+$(this).text()+'"></a>'
  });
  

})

  $('body').scrollspy('refresh');
});


</script>
</body>
</html>